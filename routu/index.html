<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>rouTU - Campus Route Planner</title>

  <!-- MapLibre GL JS -->
  <link href="https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }

    #header {
      background-color: #1e3a8a;
      color: white;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    #header h1 {
      margin: 0;
      font-size: 20px;
      display: flex;
      align-items: center;
    }

    #menu-toggle {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
    }

    #map-container {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 50px);
    }

    #sidebar {
      background-color: #f8f8f8;
      padding: 15px;
      overflow-y: auto;
      display: none;
      max-height: 300px;
    }

    #map {
      flex-grow: 1;
      width: 100%;
      height: 100%;
    }

    .sidebar-section {
      margin-bottom: 20px;
      border-bottom: 1px solid #eee;
      padding-bottom: 15px;
    }

    .sidebar-section h3 {
      margin-top: 0;
      color: #333;
      font-size: 1.1em;
      margin-bottom: 10px;
    }

    .sidebar-section select {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    #route-btn {
      margin-top: 10px;
      width: 100%;
      padding: 8px;
    }

    /* Desktop styles */
    @media (min-width: 768px) {
      #map-container {
        flex-direction: row;
      }

      #sidebar {
        display: block;
        width: 300px;
        max-height: none;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
      }

      #map {
        height: 100%;
      }

      #menu-toggle {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div id="header">
    <h1>rouTU</h1>
    <button id="menu-toggle">â˜°</button>
  </div>

  <div id="map-container">
    <div id="sidebar">
      <div class="sidebar-section">
        <h3>Today's Schedule</h3>
        <select id="class-selector">
          <option value="">Select a class</option>
          <option value="0">CS101 - Engineering Hall</option>
          <option value="1">MATH202 - Science Center</option>
          <option value="2">HIST150 - Humanities Bldg</option>
          <option value="3">BIO111 - Life Sciences</option>
        </select>
        <button id="route-btn">Show Route</button>
      </div>
    </div>
    <div id="map"></div>
  </div>

  <script>
  // Initialize map with detailed basemap style (CARTO Positron)
  const map = new maplibregl.Map({
    container: 'map',
    style: 'https://basemaps.cartocdn.com/gl/positron-gl-style/style.json', // Detailed basemap
    center: [-75.1550, 39.9811], // Temple University
    zoom: 16,
    pitch: 60,
    bearing: -20,
  });

  map.addControl(new maplibregl.NavigationControl());

  // Class locations
  const classLocations = [
    {
      name: "CS101 - Engineering Hall",
      description: "Computer Science 101, Engineering Building",
      coords: [-75.1535, 39.9822],
    },
    {
      name: "MATH202 - Science Center",
      description: "Mathematics 202, Science Center",
      coords: [-75.1570, 39.9805],
    },
    {
      name: "HIST150 - Humanities Bldg",
      description: "History 150, Humanities Building",
      coords: [-75.1545, 39.9790],
    },
    {
      name: "BIO111 - Life Sciences",
      description: "Biology 111, Life Sciences Building",
      coords: [-75.1510, 39.9808],
    },
  ];

  let routeLayerId = null;

  map.on('load', () => {
    // Add markers for classes
    classLocations.forEach(cls => {
      new maplibregl.Marker()
        .setLngLat(cls.coords)
        .setPopup(new maplibregl.Popup().setHTML(`<strong>${cls.name}</strong><br>${cls.description}`))
        .addTo(map);
    });

    // Enable 3D buildings if layer exists
    if (map.getLayer('building')) {
      map.setLayoutProperty('building', 'visibility', 'visible');
      map.setPaintProperty('building', 'fill-extrusion-color', '#aaa');
      map.setPaintProperty('building', 'fill-extrusion-height', ['get', 'height']);
      map.setPaintProperty('building', 'fill-extrusion-base', ['get', 'min_height']);
      map.setPaintProperty('building', 'fill-extrusion-opacity', 0.6);
    }
  });

  // Show route on button click
  document.getElementById('route-btn').addEventListener('click', () => {
    const selector = document.getElementById('class-selector');
    const index = selector.value;
    if (index === "") return;

    const cls = classLocations[index];
    const start = [-75.1550, 39.9811]; // Simulated start point (campus center)
    const end = cls.coords;

    if (routeLayerId) {
      if (map.getLayer(routeLayerId)) map.removeLayer(routeLayerId);
      if (map.getSource(routeLayerId)) map.removeSource(routeLayerId);
    }

    routeLayerId = `route-${Date.now()}`;

    // Draw simple straight line route (replace with real routing API later)
    map.addSource(routeLayerId, {
      type: 'geojson',
      data: {
        type: 'Feature',
        geometry: {
          type: 'LineString',
          coordinates: [start, end],
        },
      },
    });

    map.addLayer({
      id: routeLayerId,
      type: 'line',
      source: routeLayerId,
      layout: {
        'line-cap': 'round',
        'line-join': 'round',
      },
      paint: {
        'line-color': '#007AFF',
        'line-width': 4,
      },
    });
  });

  // Toggle sidebar for mobile
  document.getElementById("menu-toggle").addEventListener("click", () => {
    const sidebar = document.getElementById("sidebar");
    sidebar.style.display = sidebar.style.display === "block" ? "none" : "block";
  });
</script>
</body>
</html>
